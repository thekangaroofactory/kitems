<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtering Items • kitems</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="filtering_items_files/libs/quarto-html/popper.min.js"></script><script src="filtering_items_files/libs/quarto-html/tippy.umd.min.js"></script><link href="filtering_items_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="filtering_items_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering Items">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kitems</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/background_item_management.html">Background Item Management</a></li>
    <li><a class="dropdown-item" href="../articles/filtering_items.html">Filtering Items</a></li>
    <li><a class="dropdown-item" href="../articles/module_server_return_value.html">Module Server Return Value</a></li>
    <li><a class="dropdown-item" href="../articles/motivations.html">Motivations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filtering Items</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Kitems provides standard features to enable automatic data filtering.</p>
</section><section class="level2"><h2 id="reminder">Reminder<a class="anchor" aria-label="anchor" href="#reminder"></a>
</h2>
<p>The module server returns a composite value that includes references to reactive values:</p>
<ul>
<li><p>items</p></li>
<li><p>filtered_items</p></li>
<li><p>filter_date</p></li>
</ul>
<div class="sourceCode" id="return_value"><pre class="sourceCode R"><code class="sourceCode r"><span id="return_value-1"><a href="#return_value-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -- call module server</span></span>
<span id="return_value-2"><a href="#return_value-2" aria-hidden="true" tabindex="-1"></a>mydata <span class="ot">&lt;-</span> <span class="fu">kitems</span>(<span class="at">id =</span> <span class="st">"myid"</span>)</span>
<span id="return_value-3"><a href="#return_value-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="return_value-4"><a href="#return_value-4" aria-hidden="true" tabindex="-1"></a><span class="co"># -- access the data</span></span>
<span id="return_value-5"><a href="#return_value-5" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span><span class="fu">items</span>()</span>
<span id="return_value-6"><a href="#return_value-6" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span><span class="fu">filtered_items</span>()</span>
<span id="return_value-7"><a href="#return_value-7" aria-hidden="true" tabindex="-1"></a>mydata<span class="sc">$</span><span class="fu">filter_date</span>()</span></code></pre></div>
</section><section class="level2"><h2 id="widgets">Widgets<a class="anchor" aria-label="anchor" href="#widgets"></a>
</h2>
<section class="level3"><h3 id="item-table">Item table<a class="anchor" aria-label="anchor" href="#item-table"></a>
</h3>
<p>The <em>item</em> table widget is by default a filtered view of the <em>items</em>.<br>
It displays the content of <code>filtered_items()</code> .</p>
<p>It is delivered through the <code>filtered_view_widget</code> function.</p>
<p>The reason for not having a non filtered <em>item</em> table is that if the goal is to display the whole list of <em>items</em> without any filtering, then there would be no added value compared to using the renderDT / DTOutput functions directly in the main Shiny application.</p>
<p>As of now, only date filtering support has been implemented.</p>
</section><section class="level3"><h3 id="date-slider">Date slider<a class="anchor" aria-label="anchor" href="#date-slider"></a>
</h3>
<p>The date slider widget is automatically enabled when the data model contains an attribute that is named ‘<em>date</em>’ (strictly) and accessible through the <code>date_slider_widget</code> function.</p>
<p><img src="images/screenshot_date_slider_widget.png" alt="Screenshot of the widget"></p>
<p>Its behavior is driven by two strategies:</p>
<ul>
<li><p>‘<em>this-year</em>’ – automatically selects and extends the range of date belonging to current year upon <em>item</em> operations (this is the default).</p></li>
<li><p>‘<em>keep-range</em>’ – keeps the selected range no matter if <em>items</em> are added or removed <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;One exception is if the item that is deleted has its date being equal to the minimum or maximum of the entire range. The reason is that the min and max of the dateSliderInput will be updated when the items data frame is modified, hence it is not possible to have the selected range going beyond its limit.&lt;/p&gt;"><sup>1</sup></a></p></li>
</ul>
<p>When the server is initialized, it will scan the <em>items</em> to setup the <em>dateSliderInput</em> range to the minimum and maximum of the date column, and the selected range to the values fitting with current year. <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;current year standing for the output of &lt;code&gt;format(Sys.Date(), "%Y")&lt;/code&gt;&lt;/p&gt;'><sup>2</sup></a></p>
</section></section><section class="level2"><h2 id="reactive-lifecycle">Reactive lifecycle<a class="anchor" aria-label="anchor" href="#reactive-lifecycle"></a>
</h2>
<p>Whenever the date range value is modified in the widget, it will trigger two actions in the reactive lifecycle of the module server:</p>
<ul>
<li><p><code>filter_date</code> will be updated with the value of the slider input <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;those values could also be directly accessed through the main application input argument as &lt;code&gt;input$id-date_slider&lt;/code&gt; with &lt;em&gt;id&lt;/em&gt; being the module server namespace&lt;/p&gt;"><sup>3</sup></a></p></li>
<li><p><code>filtered_items</code> will be updated with the <em>items</em> fitting with the selected date range <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if sorting feature is enabled in the data model, it will also be sorted&lt;/p&gt;"><sup>4</sup></a></p></li>
</ul></section><section class="level2"><h2 id="considerations">Considerations<a class="anchor" aria-label="anchor" href="#considerations"></a>
</h2>
<section class="level3"><h3 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>The most important notion to understand when it comes to the initialization of the <code>filtered_items</code> (and its view) is that when the module server is launched, there is no way to determine if the main application will implement the date slider widget.</p>
<p>The module server checks the data model for a ‘<em>date</em>’ attribute and creates an output that will be accessible through the <code>date_slider_widget</code> function. But it can’t guess if it’s actually going to be implemented of not.</p>
<p>For this reason, the <code>filtered_items</code> reactive value is initialized with the same value as <code>items</code>.</p>
<p>This means, if the content of <code>filtered_items</code> is reused within the main application - for example to build a plot - it is strongly advised to check if <code>filter_date</code> is <code>NULL</code> or not to avoid computing the plot twice.</p>
<p>It can be done by implementing one of the following options in the <em>renderPlot</em> expression:</p>
<ul>
<li><p>check if the filter input is “truthy” with <code>req(mydata$filter_date())</code></p></li>
<li><p>use <code>bindEvent</code> function on the <code>filtered_items</code> with <code>ignoreInit = FALSE</code></p></li>
</ul></section></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by philippe peret.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
