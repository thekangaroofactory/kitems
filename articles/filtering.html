<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtering Items • kitems</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="filtering_files/libs/quarto-html/popper.min.js"></script><script src="filtering_files/libs/quarto-html/tippy.umd.min.js"></script><link href="filtering_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="filtering_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering Items">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kitems</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/kitems.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/core-concepts.html">Core concepts</a></li>
    <li><a class="dropdown-item" href="../articles/shiny-module.html">Shiny module</a></li>
    <li><a class="dropdown-item" href="../articles/admin.html">Administration</a></li>
    <li><a class="dropdown-item" href="../articles/implementations.html">Implementations</a></li>
    <li><a class="dropdown-item" href="../articles/communication.html">Communication</a></li>
    <li><a class="dropdown-item" href="../articles/workflows.html">Item workflows</a></li>
    <li><a class="dropdown-item" href="../articles/filtering.html">Filtering Items</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filtering Items</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <p>Kitems provides features to enable automatic data filtering at the module server level.</p>
<section class="level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Filtering mechanism in the module server relies on <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">dplyr::filter()</a></code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starwars</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"foo"</span>, </span>
<span>         <span class="va">value</span> <span class="op">==</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p>condition(s) are passed as expression(s) to the module server function using the <code>filter</code> reactive argument</p></li>
<li><p>two filtering layers are implemented</p></li>
<li><p>date slider widget is provided with several strategies</p></li>
<li><p>helper function is available to build filtering events</p></li>
</ul></section><section class="level2"><h2 id="filtering-layers">Filtering layers<a class="anchor" aria-label="anchor" href="#filtering-layers"></a>
</h2>
<p>The filtering mechanism relies on the notion of filtering layers.</p>
<section class="level3"><h3 id="pre-filtering-layer">Pre-filtering layer<a class="anchor" aria-label="anchor" href="#pre-filtering-layer"></a>
</h3>
<p>To work on a subset of the data across the app (ex. a given user).</p>
<p>It has to be considered as a lower level of filtering in the sense of the reactive chain inside the module server. The pre-filtering layer is applied from the items’ reactive object and produces an intermediate reactive object (it is not accessible from the outside of the module server).</p>
<p>If the pre-filtering layer is not set, then it will carry same content as the items.</p>
</section><section class="level3"><h3 id="main-filtering-layer">Main-filtering layer<a class="anchor" aria-label="anchor" href="#main-filtering-layer"></a>
</h3>
<p>To work on a subset of the data based on user interactions or local filters (ex. a date range)</p>
<p>It’s a higher level of filtering, that is based on the intermediate reactive object built at the pre-filtering level. If no pre-filtering is applied, then the content of the items will be used.</p>
<p>The output of this level is accessible from the server function return value <code>filtered_items</code> element.</p>
<p>The date slider filter provided by the package is applied at the main filtering layer.<br>
If the widget is implemented in the UI, it will be automatically added to the main filter expression(s) passed to the module server function.</p>
<p>This way, filters applied at the pre-filtering layer won’t need to be computed each time a user performs filtering UI interactions (saving computation time).</p>
</section></section><section class="level2"><h2 id="filtered-view">Filtered view<a class="anchor" aria-label="anchor" href="#filtered-view"></a>
</h2>
<p>The <em>item</em> table widget is by default a filtered view of the <em>items</em>.<br>
It displays the content of the <code>filtered_items</code> element of the module server function return value.</p>
<p>It is delivered through the <code><a href="../reference/filtered_view_widget.html">filtered_view_widget()</a></code> function.</p>
<div>
<blockquote>
<p><strong>Note</strong></p>
<p>The reason for not having a non filtered <em>item</em> table is that if the goal is to display the whole list of <em>items</em> without any filtering, then there would be no added value compared to using the <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">DT::renderDT()</a></code> / <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">DT::DTOutput()</a></code> functions directly in the main Shiny application.</p>
</blockquote>
</div>
</section><section class="level2"><h2 id="date-slider">Date slider<a class="anchor" aria-label="anchor" href="#date-slider"></a>
</h2>
<p>The date slider widget is automatically enabled when the data model contains an attribute that is named ‘<em>date</em>’ (strictly) and accessible through the <code><a href="../reference/date_slider_widget.html">date_slider_widget()</a></code> function.</p>
<p><img src="images/widget_date_slider.png"></p>
<p>Its behavior is driven by two strategies:</p>
<ul>
<li><p>‘<em>this-year</em>’ – automatically selects and extends the range of date belonging to current year upon <em>item</em> operations (this is the default).</p></li>
<li><p>‘<em>keep-range</em>’ – keeps the selected range no matter if <em>items</em> are added or removed <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;One exception is if the item that is deleted has its date being equal to the minimum or maximum of the entire range. The reason is that the min and max of the dateSliderInput will be updated when the items data frame is modified, hence it is not possible to have the selected range going beyond its limit.&lt;/p&gt;"><sup>1</sup></a></p></li>
</ul>
<p>When the server is initialized, it will scan the <em>items</em> to setup the range to the minimum and maximum of the date column, and the selected range to the values fitting with current year. <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;current year standing for the output of &lt;code&gt;format(Sys.Date(), "%Y")&lt;/code&gt;&lt;/p&gt;'><sup>2</sup></a></p>
</section><section class="level2"><h2 id="return-value">Return value<a class="anchor" aria-label="anchor" href="#return-value"></a>
</h2>
<p>To keep track of the filters applied to the items at a given time, the module server function includes a <code>filters</code> reactive element in its return value list.</p>
<p>The value of this element is itself a list of the form:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  pre <span class="op">=</span> <span class="op">{</span><span class="st">'expression(s) passed at the pre-filtering layer'</span><span class="op">}</span>,</span>
<span>  main <span class="op">=</span> <span class="op">{</span><span class="st">'expression(s) passed at the main-filtering layer'</span><span class="op">}</span>,</span>
<span>  date <span class="op">=</span> <span class="op">{</span><span class="st">'value of date slider input'</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</section><section class="level2"><h2 id="helper-function">Helper function<a class="anchor" aria-label="anchor" href="#helper-function"></a>
</h2>
<p>A <code><a href="../reference/filter_event.html">filter_event()</a></code> helper function is delivered to build the filtering events passed to the <code>filter</code> reactive argument.</p>
<p>The reason is that passing expressions to the module server function involves some meta-programming notions that may be too complicated for less experimented users.</p>
<p>If you want to know more about meta-programming with R, see <a href="https://adv-r.hadley.nz/metaprogramming.html" target="_blank" class="external-link">Advanced R</a> by Hadley Wickham.</p>
</section><section class="level2"><h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p><img src="images/filtering.jpg"></p>
</section><section class="level2"><h2 id="considerations">Considerations<a class="anchor" aria-label="anchor" href="#considerations"></a>
</h2>
<section class="level3"><h3 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>The most important point to understand when it comes to the initialization of the <code>filtered_items</code> (and its view) is that when the module server is launched, there is no way to determine if the main application will implement the date slider widget.</p>
<p>The module server checks the data model for a ‘<em>date</em>’ attribute and creates an output that will be accessible through the <code><a href="../reference/date_slider_widget.html">date_slider_widget()</a></code> function. But it can’t guess if it’s actually going to be implemented of not.</p>
<p>For this reason, the <code>filtered_items</code> reactive value is initialized with the same value as <code>items</code>.</p>
<p>This means, if the content of <code>filtered_items</code> is reused within the main application – for example to build a plot – it is strongly advised to check if <code>filters()$date</code> is <code>NULL</code> or not to avoid computing the plot twice.</p>
<p>It can be done by implementing one of the following options in the <em>renderPlot</em> expression:</p>
<ul>
<li><p>check if the filter input is “truthy” with <code>req(mydata$filter()$date)</code></p></li>
<li><p>use <code><a href="https://rdrr.io/pkg/shiny/man/bindEvent.html" class="external-link">shiny::bindEvent()</a></code> function on the <code>filtered_items</code> with <code>ignoreInit = TRUE</code></p></li>
</ul></section><section class="level3"><h3 id="filtering-or-not-filtering">Filtering or not filtering<a class="anchor" aria-label="anchor" href="#filtering-or-not-filtering"></a>
</h3>
<p>The filtering capabilities are delivered to provide more flexibility to manage the items and serve them throughout the app.</p>
<p>That being said, there is a choice to make for when it’s better to do filtering at the module server level or at the main app level.<br>
Because the module server return value is made of reactive objects, any update will affect the whole app wherever the return value is passed and code is taking dependency on its elements.</p>
<ul>
<li><p>do filter at the module server level when the output data is meant to be used throughout the app</p></li>
<li><p>do filter at the main app level when it is meant to be used at a local level (for example prepare data for a specific plot)</p></li>
</ul></section></section><section class="level2"><h2 id="useful-links">Useful links<a class="anchor" aria-label="anchor" href="#useful-links"></a>
</h2>
<ul>
<li><p>communication</p></li>
<li><p>shiny module</p></li>
<li><p>kitems()</p></li>
<li><p>dplyr::filter</p></li>
<li><p>helper function</p></li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.linkedin.com/in/philippeperet/" class="external-link">Philippe Peret</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
